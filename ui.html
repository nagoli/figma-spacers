<style>
  * {
      font-family: "Inter", sans-serif;
      font-weight: 500;
      font-size: 13px;
      line-height: 15px;
      letter-spacing: 0.005em;
  }
  
  #show {
      color: #CC00FF;
      border: 1px solid #CC00FF;
  }
  
  #hide {
      color: rgba(0, 0, 0, 0.6);
      border: 1px solid rgba(0, 0, 0, 0.6);
  }
  
  button {
      color: rgba(0, 0, 0, 0.8);
      border: 1px solid rgba(0, 0, 0, 0.8);
      background-color: #FFFFFF;
      padding: 7px 16px;
      border-radius: 6px;
      display: inline-block;
      margin: 0px 7px;
  }
  
  button:hover {
      cursor: pointer;
  }
  
  #switches,
  #spacers {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      flex-direction: row;
      align-items: center;
      flex-shrink: 0;
      max-width: 284px;
  }
  
  #switches {
      border-bottom: 1px solid #E5E5E5;
      padding-bottom: 7px;
  }
  
  .spacer-button {
      width: 60px;
      font-size: 18px;
      border: 1px solid rgba(222, 222, 222, 0.42);
      color: #CC00FF;
      margin: 7px;
      display: flex;
      justify-content: center;
      box-shadow: 0px 3px 12px -1px #00000033;
  }
  
  .spacer-button:hover {
      transition: all 0.2s;
      box-shadow: 0px 3px 3px -1px #00000033;
  }
  
  .spacer-button div {
      background-color: lightgray;
      vertical-align: middle;
      width: 100px;
  }
  
  button span {
      font-size: 15px;
  }
</style>


<div id="switches">
  <input type="checkbox" id="showToggle" checked onchange="switchShow()"> show </input>
  <button id="config" onclick="config()">Config</button>
</div>

<div id="spacers">
</div>

<script>
var base8 = [4, 8, 16, 24, 32, 48];
var isShown;
var showToggle = document.getElementById("showToggle");

// receive plugin properties
onmessage = (event) => {
  console.log("UI get message" );
  if (event.data.pluginMessage.type === "set-properties-from-page"){
    setSpacers(event.data.pluginMessage.spacers);
    if (event.data.pluginMessage.hide) hide(); else show(); 
  }
}

var spacerValues; 

//change ui to show the spacers button in parameter
function setSpacers(spacers){
  if (!Array.isArray(spacers)) spacers= base8;
  let div = document.getElementById("spacers");
  //reset div
  while(div.firstChild) div.removeChild(div.firstChild);
  for (let coef of spacers) {
    if (! isNaN(coef) && coef>0)
        div.appendChild(createSpacerButton(coef));
  }
  //store the spacers value
  spacerValues = spacers;
  setSpacerPropertiesInPage(spacers);
}

function switchShow(){
  if (showToggle.checked) show();
  else hide();
}


//show spacers
function show(){
  showToggle.checked = true;
  post('show-spacer-infos');
}

//hide spacers
function hide(){
  showToggle.checked = false;
  post('hide-spacer-infos');
}

//util
function arrayFrom(string){
  return string.split(',').map(Number);
}

// change ui to show configuration mode
function config(){
  let div = document.getElementById("spacers");
  //reset div
  while(div.firstChild) div.removeChild(div.firstChild);
 
 // input
  var input = document.createElement("input");
  input.id="values";
  input.value =  spacerValues.toString();
  div.appendChild(input);
 
 //button
  var button = document.createElement("button");
  button.onclick= function(){setSpacers(arrayFrom(input.value));};
  button.innerHTML = "ok";
  div.appendChild(button);

//cancel
var cancel = document.createElement("button");
  cancel.onclick= function(){setSpacers(spacerValues);};
  cancel.innerHTML = "cancel";
  div.appendChild(cancel);


//reset
var link = document.createElement("button");
  link.onclick= function(){setSpacers(base8);};
  link.innerHTML = "reset";
  div.appendChild(link);
}

// create a spacer button for a specific size
function createSpacerButton(size){
  var button = document.createElement("button");
  button.id="add"+size;
  button.onclick=function(){add(size)};
  button.className="spacer-button";
  var p = document.createElement("p");
  p.innerHTML=""+size+"px";
  button.appendChild(p);
  return button;
}

//util
function post(msg){
  parent.postMessage({ pluginMessage: { type: msg } }, '*');
}

// call code for adding a specific spacer in figma element
function add(size){
  parent.postMessage({ pluginMessage: { type: 'add-spacer', size: size } }, '*')
}

function setSpacerPropertiesInPage(spacers){
  parent.postMessage({ pluginMessage: { type: 'set-spacers-in-page', spacers: spacers } }, '*');
}

//ask for plugin properties at startup
post("get-properties-in-page");

</script>
